/* Toolbar */
ion-toolbar {
  --background: var(--ion-toolbar-background, var(--ion-background-color));
  --color: var(--ion-toolbar-color, var(--ion-text-color));
  width: 100%;
  height: 100%;
  --padding-top: 30px;
  box-shadow: none;
}

/* Danger color shorthands (map to your theme) */
.ion-color-danger { --ion-color-base: var(--ion-color-danger); }

/* Chat background */
.chat-background {
  --background: url('/assets/images/chatbackground.svg');
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
}

/* Messages area */
.chat-messages {
  display: flex;
  flex-direction: column;
  padding: 10px;
  padding-bottom: calc(100px + env(safe-area-inset-bottom));
  overflow-y: auto;
  min-height: 100%;
}

/* Bubbles */
.message-bubble {
  display: flex;
  flex-direction: column;
  width: fit-content;
  max-width: 75%;
  border-radius: 20px;
  padding: 5px 15px;
  gap: 10px;
  margin: 5px 0;
  position: relative;
  overflow: visible;
}

.sender-message {
  background: var(--chat-bubble-sent, color-mix(in srgb, var(--ion-color-primary) 14%, var(--ion-item-background)));
  align-self: flex-end;
}
.receiver-message {
  background: var(--chat-bubble-received, var(--ion-card-background));
  align-self: flex-start;
}
.message-text {
  color: var(--chat-bubble-text, var(--ion-text-color));
  font-size: 16px;
  margin: 0;
  font-family: Montserrat-SemiBold;
}
.time-stamp {
  font-size: 13px;
  color: var(--ion-color-medium);
  margin: 0 0 2px 0;
  white-space: nowrap;
  text-transform: lowercase;
}

/* Alignment helpers */
.align-end   { align-items: flex-end; }
.align-start { align-items: flex-start; }

/* Footer composer */
.footer-fixed {
  position: fixed; left: 0; right: 0; bottom: 0;
  background: transparent;
  padding: 6px 12px;
  z-index: 999;
  padding-bottom: env(safe-area-inset-bottom, 0px);
  transition: bottom .15s ease-in-out;
}
.footer-fixed.keyboard-active { bottom: 0; padding-bottom: 0; }

.footer-row {
  display: flex; align-items: center; justify-content: center; width: 100%; gap: 5px;
}
.message-input-container {
  flex: 1; display: flex; align-items: flex-end;
  background: var(--ion-item-background);
  border-radius: 20px;
  padding: 6px 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,.1);
}
.message-input {
  flex: 1; font-size: 16px; font-family: Montserrat-Medium;
  color: var(--ion-text-color);
  --padding-start: 0; --padding-end: 0;
  --background: transparent;
  --highlight-color-focused: transparent;
  border: none; background: transparent; resize: none; overflow: hidden;
  min-height: 25px; max-height: 100px;
}
.message-input::part(native) { text-align: center; }

/* Composer icons */
.icon-left, .icon-right { font-size: 22px; color: var(--ion-color-medium); }
.icon-left { margin-right: 6px; } .icon-right { margin-left: 6px; }
.attachment-btn { --background: transparent !important; box-shadow: none !important; }

/* Send / Mic */
.mic-button, .send-btn {
  --background: var(--ion-color-primary);
  --color: var(--ion-color-primary-contrast);
}
.mic-button ion-icon, .send-btn ion-icon { color: var(--ion-color-primary-contrast) !important; }

/* Content padding to clear footer */
ion-content.chat-background {
  --padding-bottom: calc(90px + env(safe-area-inset-bottom));
  overflow-y: auto;
}
.sc-ion-textarea-md-h { --padding-top: 0; --padding-bottom: 0; }

/* Date divider */
.date-divider { display: flex; justify-content: center; align-items: center; }
.text-bg-white {
  background-color: var(--ion-card-background);
  display: inline-block; padding: 4px 8px; border-radius: 4px;
}

/* Status row in bubble tail */
.status-container {
  display: flex; align-items: center; justify-content: flex-end; gap: 4px;
  font-size: 10px; color: var(--ion-color-medium);
}
.status-icon { font-size: 14px; vertical-align: middle; }
.status-icon.sent,
.status-icon.delivered { color: var(--ion-color-medium); }
.status-icon.read { color: var(--ion-color-primary); }

/* Highlights (tokenized) */
.highlighted     { background-color: color-mix(in srgb, var(--ion-color-warning) 25%, transparent); transition: background .3s ease; }
.active-highlight{ border: 2px solid var(--ion-color-warning); }

/* Calendar modal (no hardcoded colors) */
.calendar-modal::part(backdrop) { backdrop-filter: blur(8px); background: color-mix(in srgb, var(--ion-text-color) 15%, transparent); }
.calendar-modal::part(content)  { pointer-events: auto; }
::ng-deep .calendar-modal .calendar-content {
  width: 90%; max-width: 350px; margin: auto; border-radius: 12px; overflow: hidden;
  background: var(--ion-card-background) !important;
  box-shadow: 0 4px 12px rgba(0,0,0,.2);
}
.selected {
  background-color: rgba(var(--ion-color-primary-rgb), .2);
  border: 1px solid rgba(var(--ion-color-primary-rgb), .6);
  border-radius: 10px;
}

/* Pre-send preview */
.pre-message { box-shadow: 0 0 12px 0 rgba(0,0,0,.2); border-radius: 25px; padding: 10px 5px 0 5px; }
.pre-model { display: flex; flex-direction: column; justify-content: space-between; height: 100%; }
.sendbtn { display: flex; justify-content: space-between; align-items: center; }
.sendbtn p { box-shadow: 0 0 11px 0 rgba(0,0,0,.1); padding: 10px; border-radius: 25px; background: var(--ion-card-background); }
.mediasend { font-size: 25px; color: var(--ion-text-color); padding: 10px; border-radius: 25px; box-shadow: 0 0 10px 0 rgba(0,0,0,.2); background: var(--ion-color-primary); }
.mine2 { height: 100%; text-align: center; display: flex; align-items: center; }
.preview-video { width: 100%; height: auto; max-height: 100%; object-fit: contain; border-radius: 8px; display: block; }

/* Reply preview (footer) */
.reply-preview {
  background: var(--ion-color-light);
  border-top: 1px solid var(--ion-color-medium);
  padding: 8px 16px;
  margin: 0 -16px 8px -16px;
}
.reply-preview .reply-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
.reply-preview .reply-to-text { font-size: .8rem; font-weight: 500; color: var(--ion-color-primary); }
.reply-preview ion-button { --padding-start: 0; --padding-end: 0; margin: 0; height: 20px; width: 20px; --color: var(--ion-color-medium-shade); }
.reply-preview .reply-content { display: flex; align-items: flex-start; gap: 8px; }
.reply-preview .reply-line { width: 3px; height: 100%; background: var(--ion-color-primary); border-radius: 2px; min-height: 20px; }
.reply-preview .reply-message { font-size: .9rem; color: var(--ion-color-dark); flex: 1; opacity: .8; }

/* Replied message (inside bubble) */
.replied-message {
  background: rgba(var(--ion-color-primary-rgb), .1);
  border-left: 3px solid var(--ion-color-primary);
  border-radius: 8px; padding: 8px 12px; margin-bottom: 8px; cursor: pointer; transition: all .3s ease;
}
.replied-message:hover { background: rgba(var(--ion-color-primary-rgb), .15); }
.replied-message .replied-header { display: flex; align-items: center; gap: 6px; margin-bottom: 4px; }
.replied-message .reply-icon   { font-size: .9rem; color: var(--ion-color-primary); }
.replied-message .replied-sender{ font-size: .8rem; font-weight: 500; color: var(--ion-color-primary); }
.replied-message .replied-content .replied-text,
.replied-message .replied-content .replied-attachment {
  font-size: .85rem; color: var(--ion-color-dark); opacity: .8; line-height: 1.3;
}
.replied-message .replied-content ion-icon { font-size: .9rem; }

/* Chat header / pinned */
.chat-header .chat-title-container { text-align: center; }
.chat-header .chat-name { font-size: 16px; font-weight: 600; display: block; }
.chat-header .online-status { font-size: 12px; color: var(--ion-color-medium); display: block; }

/* pinned header/banner â€” expose tokens for gradient endpoints */
:root {
  --pinned-start: var(--ion-color-primary);
  --pinned-end:   color-mix(in srgb, var(--ion-color-primary) 70%, var(--ion-color-tertiary, var(--ion-color-primary)));
}
.pinned-message-header,
.pinned-message-banner {
  background: linear-gradient(135deg, var(--pinned-start) 0%, var(--pinned-end) 100%);
  color: var(--ion-color-primary-contrast, #fff);
}
.pinned-message-header {
  padding: 8px 16px; cursor: pointer; border-top: 1px solid rgba(255,255,255,.1);
}
.pinned-message-header .pinned-header-content .pinned-header-info {
  display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;
}
.pinned-message-header .pin-icon-header { font-size: 14px; margin-right: 6px; color: color-mix(in srgb, var(--ion-color-warning) 80%, #fff); }
.pinned-message-header .pinned-label { font-size: 12px; font-weight: 500; flex-grow: 1; opacity: .9; }
.pinned-message-header .unpin-icon-header { font-size: 16px; opacity: .8; padding: 4px; border-radius: 50%; }
.pinned-message-header .pinned-message-content { font-size: 13px; display: flex; align-items: center; opacity: .95; }

.pinned-message-banner {
  position: fixed; top: 0; left: 0; right: 0; padding: 8px 16px; z-index: 1000; cursor: pointer;
  box-shadow: 0 2px 8px rgba(0,0,0,.15);
  border-bottom: 1px solid rgba(255,255,255,.1);
}

.pinned-strip {
  display: flex; align-items: center;
  background-color: var(--ion-card-background);
  border-bottom: 1px solid var(--ion-border-color);
  padding: 8px 12px; cursor: pointer;
}
.pinned-icon { font-size: 18px; color: var(--ion-color-medium); margin-right: 8px; }
.pinned-text { flex: 1; font-size: 14px; color: var(--ion-text-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.close-icon  { font-size: 18px; color: var(--ion-color-medium); margin-left: 8px; }

.forwarded-label,
.forwarded-icon { color: var(--ion-color-medium); }
.forwarded-label { font-size: 11px; display: flex; align-items: center; margin-bottom: 2px; }
.forwarded-icon  { font-size: 12px; margin-right: 3px; }

/* Misc structure */
.pre-model { display: flex; flex-direction: column; justify-content: space-between; height: 100vh; }
.user-head { margin-left: 15px; }
.pre-icons { gap: 20px; }
.hd-icon { width: 25px; }
.blur-background { filter: blur(6px); pointer-events: none; }
.custom-modal-header { display: flex; justify-content: space-between; }
.model-header { position: absolute; top: 0; left: 0; width: 100%; box-shadow: none; }
.mine { position: fixed; bottom: 0; left: 0; width: 100%; }
.model-toll { --background: transparent; }
.head-allicon {
  background: color-mix(in srgb, var(--ion-text-color) 20%, transparent);
  border-radius: 15px; width: 30px; height: 30px; display: flex; justify-content: center;
}

/* Typing indicator */
.typing-indicator-wrapper {
  position: absolute; left: 12px; right: 12px; bottom: 100px;
  display: flex; justify-content: flex-start; pointer-events: none; z-index: 9999;
  transition: opacity 180ms ease, transform 180ms ease;
}
.typing-indicator-content {
  display: flex; align-items: center; gap: 10px; padding: 8px 12px;
  background: var(--ion-card-background);
  box-shadow: 0 6px 18px rgba(0,0,0,.12);
  border-radius: 20px; backdrop-filter: blur(4px); pointer-events: none;
}
.typing-indicator-content.group   { justify-content: flex-start; }
.typing-indicator-content.private { justify-content: center; padding-left: 18px; padding-right: 18px; }

.typing-text {
  display: flex; align-items: center; min-width: 0;
  font-size: 13px; color: var(--ion-text-color);
  white-space: nowrap; max-width: 220px; overflow: hidden; text-overflow: ellipsis;
}
.typing-avatar.single { width: 34px; height: 34px; border-radius: 50%; object-fit: cover; flex: 0 0 auto; }
.typing-label { margin-left: 10px; font-size: 14px; color: var(--ion-text-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 160px; }

.avatar-stack { display: flex; align-items: center; position: relative; height: 34px; }
.typing-avatar.stacked {
  width: 30px; height: 30px; border-radius: 50%; object-fit: cover;
  border: 2px solid var(--ion-card-background);
  box-shadow: 0 0 0 1px rgba(0,0,0,.06);
  margin-left: -10px; flex: 0 0 auto;
}
.typing-avatar.idx-0 { margin-left: 0; z-index: 30; }

.more-badge {
  margin-left: 6px; font-size: 12px; min-width: 28px; height: 28px;
  display: inline-flex; align-items: center; justify-content: center;
  border-radius: 14px; background: var(--ion-color-primary); color: var(--ion-color-primary-contrast);
  padding: 0 6px; box-shadow: 0 1px 2px rgba(0,0,0,.08);
}
.typing-dots { display: flex; align-items: center; gap: 6px; }
.typing-dots.center-only { margin: 0; }
.typing-dots .dot {
  width: 8px; height: 8px; border-radius: 50%;
  background: var(--ion-color-medium);
  opacity: .9; transform: translateY(0);
  animation: typingDot 1s infinite ease-in-out;
}
.typing-dots .dot:nth-child(2) { animation-delay: .15s; }
.typing-dots .dot:nth-child(3) { animation-delay: .3s; }
@keyframes typingDot {
  0% { transform: translateY(0); opacity: .4; }
  30%{ transform: translateY(-4px); opacity: 1; }
  60%{ transform: translateY(0); opacity: .7; }
  100%{ transform: translateY(0); opacity: .4; }
}

/* Success/neutral system bubbles */
.system-bubble {
  background: var(--ion-card-background);
  color: var(--ion-text-color);
  padding: 8px 14px; border-radius: 18px; max-width: 85%;
  box-shadow: 0 1px 1px rgba(0,0,0,.08); font-size: 14px; text-align: center; cursor: pointer;
}
.system-bubble-success {
  background: color-mix(in srgb, var(--ion-color-success) 18%, var(--ion-card-background));
  color: var(--ion-color-success-contrast, var(--ion-text-color));
}

/* Blocked footer + icons */
.blocked-action-footer { border-top: 1px solid var(--ion-border-color); }
.delete-chat-btn ion-icon, .unblock-btn ion-icon { font-size: 20px; }

/* Presence */
.online-dot {
  width: 8px; height: 8px; border-radius: 50%; background-color: var(--ion-color-success);
  display: inline-block;
  box-shadow: 0 0 0 3px color-mix(in srgb, var(--ion-color-success) 30%, transparent);
}

/* Last-seen marquee */
.last-seen-scroll { position: relative; overflow: hidden; white-space: nowrap; max-width: 150px; }
.last-seen-scroll span { display: inline-block; padding-left: 100%; animation: scroll-left 6s linear infinite; }
@keyframes scroll-left { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

/* Fade-in */
.message-bubble.fade-in {
  opacity: 0; transform: translateY(10px) scale(.95); animation: fadeIn .8s forwards;
}
@keyframes fadeIn {
  0%   { opacity: 0; transform: translateY(10px) scale(.95); }
  60%  { opacity: 1; transform: translateY(-2px) scale(1.02); }
  100% { opacity: 1; transform: translateY(0) scale(1); }
}

/* Disintegration/fade-out (tokenized) */
.message-bubble.fade-out {
  position: relative; animation: preShake .2s ease-in-out, messageDisintegrate 1.8s ease-out .2s forwards;
  overflow: visible; z-index: 1;
}
@keyframes preShake {
  0%,100% { transform: translateX(0) scale(1); }
  25%     { transform: translateX(-3px) scale(1.01); }
  75%     { transform: translateX(3px)  scale(1.01); }
}
@keyframes messageDisintegrate {
  0%   { opacity: 1;   transform: scale(1)   translateY(0);   filter: blur(0); }
  15%  { opacity: .9;  transform: scale(1.02) translateY(-2px); filter: blur(0); }
  30%  { opacity: .7;  transform: scale(1.05) translateY(-5px); filter: blur(.5px); }
  50%  { opacity: .4;  transform: scale(1.1)  translateY(-8px); filter: blur(1px); }
  70%  { opacity: .2;  transform: scale(1.2)  translateY(-12px);filter: blur(2px); }
  85%  { opacity: .1;  transform: scale(1.3)  translateY(-18px);filter: blur(3px); }
  100% { opacity: 0;   transform: scale(1.5)  translateY(-25px);filter: blur(4px); }
}

/* Particle layers (use currentColor / tokens) */
.message-bubble.fade-out::before,
.message-bubble.fade-out::after {
  content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
  border-radius: inherit; pointer-events: none; z-index: 2;
}
.message-bubble.fade-out::before {
  background-color: inherit;
  mask-image:
    radial-gradient(circle at 20% 30%, transparent 8px, black 10px, black 15px, transparent 17px),
    radial-gradient(circle at 80% 20%, transparent 6px, black 8px, black 12px, transparent 14px),
    radial-gradient(circle at 30% 80%, transparent 7px, black 9px, black 14px, transparent 16px),
    radial-gradient(circle at 70% 70%, transparent 5px, black 7px, black 11px, transparent 13px),
    radial-gradient(circle at 50% 40%, transparent 9px, black 11px, black 16px, transparent 18px),
    radial-gradient(circle at 15% 60%, transparent 4px, black 6px, black 10px, transparent 12px),
    radial-gradient(circle at 85% 50%, transparent 6px, black 8px, black 13px, transparent 15px),
    radial-gradient(circle at 40% 15%, transparent 7px, black 9px, black 12px, transparent 14px);
  mask-size: 100% 100%;
  mask-composite: subtract; -webkit-mask-composite: xor;
  animation: particleScatter1 1.8s ease-out forwards; animation-delay: .3s; opacity: 0;
}
@keyframes particleScatter1 {
  0% { opacity: 1; transform: scale(1)   rotate(0);  filter: blur(0); }
  20%{ opacity: .9;transform: scale(1.1) rotate(5deg);filter: blur(.5px); }
  40%{ opacity: .7;transform: scale(1.3) rotate(15deg);filter: blur(1px); }
  60%{ opacity: .5;transform: scale(1.6) rotate(25deg);filter: blur(2px); }
  80%{ opacity: .2;transform: scale(2.2) rotate(40deg);filter: blur(3px); }
  100%{opacity: 0; transform: scale(3.5) rotate(60deg);filter: blur(5px); }
}
.message-bubble.fade-out::after {
  background:
    radial-gradient(circle at 25% 25%, currentColor 2px, transparent 3px),
    radial-gradient(circle at 75% 35%, currentColor 1.5px, transparent 2.5px),
    radial-gradient(circle at 45% 75%, currentColor 2.5px, transparent 3.5px),
    radial-gradient(circle at 65% 15%, currentColor 1px, transparent 2px),
    radial-gradient(circle at 15% 85%, currentColor 2px, transparent 3px),
    radial-gradient(circle at 85% 85%, currentColor 1.5px, transparent 2.5px),
    radial-gradient(circle at 55% 45%, currentColor 1px, transparent 2px),
    radial-gradient(circle at 35% 55%, currentColor 2px, transparent 3px),
    radial-gradient(circle at 10% 40%, currentColor 1.5px, transparent 2.5px),
    radial-gradient(circle at 90% 60%, currentColor 1px, transparent 2px),
    radial-gradient(circle at 50% 10%, currentColor 2px, transparent 3px),
    radial-gradient(circle at 30% 90%, currentColor 1.5px, transparent 2.5px);
  background-size:
    30px 30px, 25px 25px, 35px 35px, 20px 20px,
    28px 28px, 25px 25px, 18px 18px, 32px 32px,
    22px 22px, 26px 26px, 24px 24px, 30px 30px;
  background-repeat: no-repeat;
  animation: particleScatter2 2s ease-out forwards; animation-delay: .4s; opacity: 0;
}
@keyframes particleScatter2 {
  0% { opacity: 0;   transform: scale(.8) rotate(0);   filter: blur(0); }
  15%{ opacity: .8;  transform: scale(1)   rotate(-10deg); }
  30%{ opacity: .7;  transform: scale(1.4) rotate(-20deg); filter: blur(.5px); }
  50%{ opacity: .5;  transform: scale(2)   rotate(-35deg); filter: blur(1px); }
  70%{ opacity: .3;  transform: scale(2.8) rotate(-50deg); filter: blur(2px); }
  90%{ opacity: .1;  transform: scale(3.8) rotate(-70deg); filter: blur(3px); }
  100%{ opacity: 0;  transform: scale(5)   rotate(-90deg); filter: blur(4px); }
}

/* Colorize particles by role via currentColor */
.message-bubble.sender-message { color: rgba(var(--ion-color-primary-rgb), .85); }
.message-bubble.receiver-message { color: color-mix(in srgb, var(--ion-text-color) 65%, transparent); }

/* Accessibility / motion */
@media (prefers-reduced-motion: reduce) {
  .typing-indicator-wrapper,
  .message-bubble.fade-in,
  .message-bubble.fade-out { animation: none !important; }
}


.msg-row {
  position: relative;
  overflow: visible;
}

/* Floating picker (on long-press) */
.reaction-bar {
  position: absolute;
  top: -10px;
  transform: translateY(-100%);
  display: flex;
  gap: 6px;
  background: #fff;
  padding: 6px 8px;
  border-radius: 24px;
  box-shadow: 0 6px 18px rgba(0,0,0,.16);
  z-index: 9999;

  &.right { right: 8px; }
  &.left  { left: 8px; }

  .react-btn {
    border: none;
    background: transparent;
    font-size: 18px;
    line-height: 1;
    padding: 4px 6px;
    border-radius: 14px;
  }
  .more { font-weight: 700; font-size: 16px; }
}

/* Compact badges below bubble, anchored to corner */
.reaction-badges {
  position: absolute;
  bottom: -6px;          /* bubble ki niche thodi si space */
  display: flex;
  gap: 4px;
  z-index: 5;

  &.right { right: 12px; }  /* sender bubble */
  &.left  { left: 12px; }   /* receiver bubble */

  .badge {
    min-width: 28px;
    height: 28px;
    padding: 0 6px;
    border-radius: 999px;
    background: #fff;
    box-shadow: 0 2px 8px rgba(0,0,0,.12);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
    border: 1px solid #eee;
  }
  .badge.mine {
    border-color: var(--ion-color-primary);
  }
  .emoji { font-size: 16px; line-height: 1; }
  .cnt { font-size: 12px; color: #444; }
}


